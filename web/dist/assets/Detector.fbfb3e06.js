import{a as k}from"./configs.6ceae54f.js";import{E as F}from"./ExForm.d5ddb982.js";import{F as f}from"./ExFormInterface.d1e14f35.js";import{E as A}from"./ExLoading.befd655b.js";import{s as I,G as N,q as O,X as L,a0 as p,E as R}from"./index.1e068ea3.js";import{h as w,r as y,G as a,f as T}from"./ui.c327b114.js";import{u as V,r as E,A as M,s as U,d as X}from"./naive.650dd42a.js";import{c as q,E as G,b as P}from"./ExTable.6634af00.js";function v(){}var u;(function(e){e.name="name",e.status="status",e.timeout="timeout",e.owners="owners",e.receivers="receivers",e.description="description"})(u||(u={}));function $(){return[{name:"\u540D\u79F0\uFF1A",key:u.name,placeholder:"\u8BF7\u8F93\u5165\u68C0\u6D4B\u914D\u7F6E\u540D\u79F0"},{name:"\u72B6\u6001\uFF1A",key:u.status,type:f.Select,placeholder:"\u8BF7\u9009\u62E9\u914D\u7F6E\u72B6\u6001",options:[{label:"\u542F\u7528",value:k.Enabled},{label:"\u7981\u7528",value:k.Disabled}]},{name:"\u8D85\u65F6\u65F6\u957F\uFF1A",key:u.timeout,type:f.InputDuration,placeholder:"\u8BF7\u8F93\u5165\u8D85\u65F6\u65F6\u957F"},{name:"\u7528\u6237\u5217\u8868\uFF1A",key:u.owners,type:f.MultiUserSelect,placeholder:"\u8BF7\u9009\u62E9\u53EF\u4EE5\u4FEE\u6539\u6B64\u914D\u7F6E\u7684\u7528\u6237",span:12},{name:"\u544A\u8B66\u63A5\u6536\uFF1A",key:u.receivers,type:f.MultiUserSelect,placeholder:"\u8BF7\u9009\u62E9\u63A5\u6536\u6B64\u544A\u8B66\u7684\u7528\u6237",span:12}]}function D(e){return{required:!0,message:e,trigger:"blur"}}function ie(e){return{required:!0,message:e,trigger:"blur",validator(r,t){return!(!t||!t.length)}}}function ue(e){const r={[u.name]:D("\u914D\u7F6E\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A"),[u.status]:{required:!0,message:"\u914D\u7F6E\u72B6\u6001\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur",validator(t,i){return!!i}},[u.timeout]:D("\u8D85\u65F6\u914D\u7F6E\u4E0D\u80FD\u4E3A\u7A7A"),[u.description]:D("\u914D\u7F6E\u8BF4\u660E\u4E0D\u80FD\u4E3A\u7A7A")};return e?Object.assign(r,e):r}function z(e,r){e.forEach(t=>{if(!t.key)return;const i=r[t.key];t.defaultValue=i})}var H=w({name:"ExDetectorEditor",props:{id:{type:Number,default:0},title:{type:String,required:!0},description:{type:String,required:!0},descriptionDetail:{type:Object,default:()=>null},formItems:{type:Array,required:!0},onBack:{type:Function,default:v},findByID:{type:Function,required:!0},updateByID:{type:Function,required:!0},create:{type:Function,required:!0},rules:{type:Object,default:null}},setup(e){const r=V(),t=y(!1),i=y(!1),s=[];e.formItems.forEach(n=>{s.push(Object.assign({},n))}),s.push({name:"\u914D\u7F6E\u63CF\u8FF0\uFF1A",key:u.description,type:f.TextArea,placeholder:"\u8BF7\u8F93\u5165\u914D\u7F6E\u63CF\u8FF0",span:24});let l;const d=async()=>{if(!t.value){t.value=!0;try{l=await e.findByID(e.id),z(s,l)}catch(n){I(r,n)}finally{t.value=!1}}},c=async n=>{if(!i.value)try{if(i.value=!0,!e.id){await e.create(n),e.onBack();return}const o=N(n,l);if(!o.modifiedCount){O(r,"\u6570\u636E\u672A\u4FEE\u6539\u65E0\u9700\u8981\u66F4\u65B0");return}await e.updateByID(e.id,o.data),e.onBack()}catch(o){I(r,o)}finally{i.value=!1}};return e.id&&d(),{fetching:t,processing:i,items:s,submit:c}},render(){const{title:e,description:r,id:t,onBack:i,descriptionDetail:s,rules:l}=this.$props,{fetching:d,processing:c,items:n,submit:o}=this;return d&&t?a(A,null,null):a(U,{show:d||c},{default:()=>[a(E,null,{default:()=>[a(M,{title:e,onBack:i==v?void 0:i,subtitle:r},{default:()=>[s,a(F,{formItems:n,onSubmit:o,submitText:t!==0?"\u66F4\u65B0":"\u6DFB\u52A0",rules:l},null)]})]})]})}});function W(){return[{title:"\u540D\u79F0",key:"name",width:120,fixed:"left"},{title:"\u72B6\u6001",key:"status",render(e){return e.statusDesc},width:60},{title:"\u8D85\u65F6\u8BBE\u7F6E",key:"timeout",width:80},q({key:"owners",title:"\u6240\u6709\u4EBA",width:120}),q({key:"receivers",title:"\u544A\u8B66\u63A5\u6536\u4EBA",width:120}),{title:"\u66F4\u65B0\u4E8E",key:"updatedAt",render(e){return L(e.updatedAt)}},{title:"\u914D\u7F6E\u63CF\u8FF0",key:"description",width:100,ellipsis:{tooltip:!0}}]}const _="a1r7hurf";var ne=w({name:"DetectorView",props:{title:{type:String,required:!0},description:{type:String,required:!0},descriptionDetail:{type:Object,default:()=>null},columns:{type:Array,required:!0},formItems:{type:Array,required:!0},fetch:{type:Function,required:!0},findByID:{type:Function,required:!0},updateByID:{type:Function,required:!0},create:{type:Function,required:!0},data:{type:Object,required:!0},rules:{type:Object,default:null},tableScrollX:{type:Number,default:()=>null}},setup(){const e=y(p.List),r=y(0);return{mode:e,updatedID:r,userInfo:R().info}},render(){const{data:e,findByID:r,updateByID:t,create:i,title:s,description:l,formItems:d,columns:c,fetch:n,descriptionDetail:o,rules:B,tableScrollX:j}=this.$props,{userInfo:x}=this,h=W().slice(0);h.splice(1,0,...c);const b=P(m=>{this.mode=p.Update,this.updatedID=m.id});b.fixed="right",h.push(b);const{mode:S,updatedID:C}=this;if(S===p.List)return a(E,{title:s},{default:()=>[a(G,{columns:h,data:e,fetch:n,scrollX:j},null),a(X,{size:"large",onClick:()=>{this.updatedID=0,this.mode=p.Add},class:_},{default:()=>[T("\u589E\u52A0\u68C0\u6D4B\u914D\u7F6E")]})]});const g=$();return g.forEach(m=>{["owners","receivers"].includes(m.key)&&(m.defaultValue=[x.account])}),g.push(...d),a(H,{id:C,findByID:r,updateByID:t,create:i,title:s,description:l,formItems:g,descriptionDetail:o,onBack:()=>{this.mode=p.List},rules:B},null)}});export{ne as D,ie as a,ue as g,D as n};
