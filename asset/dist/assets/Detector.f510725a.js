import{a as D}from"./configs.45777d5a.js";import{E as F}from"./ExForm.141618cc.js";import{F as c}from"./ExFormInterface.d1e14f35.js";import{E as A}from"./ExLoading.befd655b.js";import{s as v,G as N,q as O,X as L,a0 as p,E as V}from"./index.14cddf8e.js";import{h as I,r as y,G as s,f as R}from"./ui.c327b114.js";import{u as T,r as w,A as M,s as U,d as X}from"./naive.650dd42a.js";import{c as E,E as z,b as G}from"./ExTable.2a9f5263.js";function q(){}var a;(function(e){e.name="name",e.status="status",e.timeout="timeout",e.owners="owners",e.receivers="receivers",e.description="description",e.interval="interval"})(a||(a={}));function P(){return[{name:"\u540D\u79F0\uFF1A",key:a.name,span:6,placeholder:"\u8BF7\u8F93\u5165\u68C0\u6D4B\u914D\u7F6E\u540D\u79F0"},{name:"\u72B6\u6001\uFF1A",key:a.status,type:c.Select,placeholder:"\u8BF7\u9009\u62E9\u914D\u7F6E\u72B6\u6001",span:4,options:[{label:"\u542F\u7528",value:D.Enabled},{label:"\u7981\u7528",value:D.Disabled}],defaultValue:D.Enabled},{name:"\u8D85\u65F6\u65F6\u957F\uFF1A",span:7,key:a.timeout,type:c.InputDuration,placeholder:"\u8BF7\u8F93\u5165\u8D85\u65F6\u65F6\u957F",defaultValue:"3s"},{name:"\u68C0\u6D4B\u95F4\u9694\uFF1A",span:7,key:a.interval,type:c.InputDuration,placeholder:"\u8BF7\u8F93\u5165\u68C0\u6D4B\u95F4\u9694"},{name:"\u7528\u6237\u5217\u8868\uFF1A",key:a.owners,type:c.MultiUserSelect,placeholder:"\u8BF7\u9009\u62E9\u53EF\u4EE5\u4FEE\u6539\u6B64\u914D\u7F6E\u7684\u7528\u6237",span:12},{name:"\u544A\u8B66\u63A5\u6536\uFF1A",key:a.receivers,type:c.MultiUserSelect,placeholder:"\u8BF7\u9009\u62E9\u63A5\u6536\u6B64\u544A\u8B66\u7684\u7528\u6237",span:12}]}function b(e){return{required:!0,message:e,trigger:"blur"}}function ie(e){return{required:!0,message:e,trigger:"blur",validator(r,t){return!(!t||!t.length)}}}function ae(e){const r={[a.name]:b("\u914D\u7F6E\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A"),[a.status]:{required:!0,message:"\u914D\u7F6E\u72B6\u6001\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur",validator(t,i){return!!i}},[a.timeout]:b("\u8D85\u65F6\u914D\u7F6E\u4E0D\u80FD\u4E3A\u7A7A"),[a.description]:b("\u914D\u7F6E\u8BF4\u660E\u4E0D\u80FD\u4E3A\u7A7A")};return e?Object.assign(r,e):r}function $(e,r){e.forEach(t=>{if(!t.key)return;const i=r[t.key];t.defaultValue=i})}var H=I({name:"ExDetectorEditor",props:{id:{type:Number,default:0},title:{type:String,required:!0},description:{type:String,required:!0},descriptionDetail:{type:Object,default:()=>null},formItems:{type:Array,required:!0},onBack:{type:Function,default:q},findByID:{type:Function,required:!0},updateByID:{type:Function,required:!0},create:{type:Function,required:!0},rules:{type:Object,default:null}},setup(e){const r=T(),t=y(!1),i=y(!1),u=[];e.formItems.forEach(n=>{u.push(Object.assign({},n))}),u.push({name:"\u914D\u7F6E\u63CF\u8FF0\uFF1A",key:a.description,type:c.TextArea,placeholder:"\u8BF7\u8F93\u5165\u914D\u7F6E\u63CF\u8FF0",span:24});let o;const d=async()=>{if(!t.value){t.value=!0;try{o=await e.findByID(e.id),$(u,o)}catch(n){v(r,n)}finally{t.value=!1}}},f=async n=>{if(!i.value)try{if(i.value=!0,!e.id){await e.create(n),e.onBack();return}const l=N(n,o);if(!l.modifiedCount){O(r,"\u6570\u636E\u672A\u4FEE\u6539\u65E0\u9700\u8981\u66F4\u65B0");return}await e.updateByID(e.id,l.data),e.onBack()}catch(l){v(r,l)}finally{i.value=!1}};return e.id&&d(),{fetching:t,processing:i,items:u,submit:f}},render(){const{title:e,description:r,id:t,onBack:i,descriptionDetail:u,rules:o}=this.$props,{fetching:d,processing:f,items:n,submit:l}=this;return d&&t?s(A,null,null):s(U,{show:d||f},{default:()=>[s(w,null,{default:()=>[s(M,{title:e,onBack:i==q?void 0:i,subtitle:r},{default:()=>[u,s(F,{formItems:n,onSubmit:l,submitText:t!==0?"\u66F4\u65B0":"\u6DFB\u52A0",rules:o},null)]})]})]})}});function W(){return[{title:"\u540D\u79F0",key:"name",width:120,fixed:"left"},{title:"\u72B6\u6001",key:"status",render(e){return e.statusDesc},width:60},{title:"\u8D85\u65F6\u8BBE\u7F6E",key:"timeout",width:80},{title:"\u68C0\u6D4B\u95F4\u9694",key:"interval",width:80},E({key:"owners",title:"\u6240\u6709\u4EBA",width:120}),E({key:"receivers",title:"\u544A\u8B66\u63A5\u6536\u4EBA",width:120}),{title:"\u66F4\u65B0\u4E8E",key:"updatedAt",render(e){return L(e.updatedAt)}},{title:"\u914D\u7F6E\u63CF\u8FF0",key:"description",width:100,ellipsis:{tooltip:!0}}]}const _="a1r7hurf";var ne=I({name:"DetectorView",props:{title:{type:String,required:!0},description:{type:String,required:!0},descriptionDetail:{type:Object,default:()=>null},columns:{type:Array,required:!0},formItems:{type:Array,required:!0},fetch:{type:Function,required:!0},findByID:{type:Function,required:!0},updateByID:{type:Function,required:!0},create:{type:Function,required:!0},data:{type:Object,required:!0},rules:{type:Object,default:null},tableScrollX:{type:Number,default:()=>null}},setup(){const e=y(p.List),r=y(0);return{mode:e,updatedID:r,userInfo:V().info}},render(){const{data:e,findByID:r,updateByID:t,create:i,title:u,description:o,formItems:d,columns:f,fetch:n,descriptionDetail:l,rules:B,tableScrollX:j}=this.$props,{userInfo:x}=this,h=W().slice(0);h.splice(1,0,...f);const k=G(m=>{this.mode=p.Update,this.updatedID=m.id});k.fixed="right",h.push(k);const{mode:S,updatedID:C}=this;if(S===p.List)return s(w,{title:u},{default:()=>[s(z,{columns:h,data:e,fetch:n,scrollX:j,pageSize:10},null),s(X,{size:"large",onClick:()=>{this.updatedID=0,this.mode=p.Add},class:_},{default:()=>[R("\u589E\u52A0\u68C0\u6D4B\u914D\u7F6E")]})]});const g=P();return g.forEach(m=>{["owners","receivers"].includes(m.key)&&(m.defaultValue=[x.account])}),g.push(...d),s(H,{id:C,findByID:r,updateByID:t,create:i,title:u,description:o,formItems:g,descriptionDetail:l,onBack:()=>{this.mode=p.List},rules:B},null)}});export{ne as D,ie as a,ae as g,b as n};
