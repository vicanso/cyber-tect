import{c as C,d as v,s as b,a as N,e as E,f as x,h as L,i as R}from"./index-aeeb7070.js";import{d as V,r as d,f as T,N as e,c as q,i as z}from"./ui-32540f7e.js";import{u as G,t as I,x as g,y as h,v as O,w as y,d as $,r as j}from"./naive-094f875f.js";function k(t){return typeof t=="function"||Object.prototype.toString.call(t)==="[object Object]"&&!z(t)}const w="login",P="c1eq9ar",S="c1ppv7dc",U="sd1d3ho",B="cvblerb",W=V({name:"ExLoginRegister",props:{type:{type:String,default:w}},setup(t){const r=d({account:"",password:"",captcha:""}),s=G(),l=t.type===w,c=d(!1),o=d(C()),n=async()=>{try{o.value.id="";const a=await v();o.value=a}catch(a){b(s,a)}},u=async()=>{if(c.value)return;const{account:a,password:f,captcha:m}=r.value;if(!a||!f||!m){N(s,"账号、密码及图形验证码均不能为空");return}try{c.value=!0;const p={account:a,password:f,captcha:`${o.value.id}:${m}`};l?await E(p):await x(p),l?L(!0):R(!0)}catch(p){b(s,p),n()}finally{c.value=!1}},i=a=>{a.code==="Enter"&&u()};return T(()=>{n()}),{refreshCaptcha:n,loginOrRegister:u,handleEnterPress:i,isLogin:l,captchaData:o,model:r,processing:c,rules:{account:{required:!0,message:"账号不能为空",trigger:"blur"},password:{required:!0,message:"密码不能为空",trigger:"blur"},captcha:{required:!0,message:"图形验证码不能为空",trigger:"blur"}}}},render(){const t="large",{model:r,captchaData:s,rules:l,processing:c,isLogin:o,handleEnterPress:n}=this,u=o?"用户登录":"用户注册",i=o?"登录":"注册";return e(j,{title:u,class:P},{default:()=>[e(I,{labelWidth:"100",labelAlign:"right",labelPlacement:"left",size:t,rules:l,model:r},{default:()=>[e(g,{label:"账号：",path:"account"},{default:()=>[e(h,{placeholder:"请输入账号",clearable:!0,autofocus:!0,onUpdateValue:a=>{r.account=a}},null)]}),e(g,{label:"密码：",path:"password"},{default:()=>[e(h,{type:"password",placeholder:"请输入密码",clearable:!0,"show-password-on":"click",onUpdateValue:a=>{r.password=a}},null)]}),e(g,{label:"验证码：",path:"captcha"},{default:()=>[e(O,{cols:4},{default:()=>[e(y,{span:3},{default:()=>[e(h,{placeholder:"请输入验证码",maxlength:4,clearable:!0,onKeyup:n,onUpdateValue:a=>{r.captcha=a}},null)]}),e(y,{span:1},{default:()=>[e("div",{class:S,onClick:this.refreshCaptcha},[s.id&&e("img",{class:B,src:`data:image/${s.type};base64,${s.data}`},null),!s.id&&e("span",null,[q("...")])])]})]})]}),e($,{loading:c,class:U,size:t,onClick:this.loginOrRegister},k(i)?i:{default:()=>[i]})]})]})}});export{W as E};
