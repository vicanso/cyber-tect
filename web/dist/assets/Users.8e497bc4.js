import{E as b}from"./ExForm.d5ddb982.js";import{F as d}from"./ExFormInterface.d1e14f35.js";import{E as h,a as v}from"./ExTable.6634af00.js";import{C as k,E as g,F as I,G as j,q as E,I as U,s as x}from"./index.1e068ea3.js";import{u as F,r as C,A as w,s as N,e as S,d as V}from"./naive.650dd42a.js";import{h as T,r as m,z as B,G as s,f as M}from"./ui.c327b114.js";import"./detector.29976283.js";import"./common.c9fa31ee.js";const q="ulmcati";function D(){return[{title:"\u8D26\u6237",key:"account"},{title:"\u89D2\u8272",key:"roles",render:e=>{if(!e.roles)return null;const r=e.roles.map(o=>s("li",null,[o]));return s("ul",{class:q},[r])}},{title:"\u72B6\u6001",key:"statusDesc"},{title:"\u90AE\u7BB1",key:"email"}]}function G(){return[{name:"\u89D2\u8272\uFF1A",key:"role",placeholder:"\u8BF7\u9009\u62E9\u8981\u7B5B\u9009\u7684\u7528\u6237\u89D2\u8272",type:d.Select,options:[{label:"\u6240\u6709",value:""},{label:"\u8D85\u7EA7\u7528\u6237",value:"su"},{label:"\u7BA1\u7406\u5458",value:"admin"}]},{name:"\u72B6\u6001\uFF1A",key:"status",placeholder:"\u8BF7\u9009\u62E9\u8981\u7B5B\u9009\u7684\u8D26\u6237\u72B6\u6001",type:d.Select,options:[{label:"\u6240\u6709",value:""},{label:"\u542F\u7528",value:"1"},{label:"\u7981\u7528",value:"2"}]},{name:"\u5173\u952E\u5B57\uFF1A",key:"keyword",placeholder:"\u8BF7\u8F93\u5165\u641C\u7D22\u5173\u952E\u5B57"}]}function L(e){return[{name:"\u8D26\u53F7\uFF1A",key:"account",disabled:!0,defaultValue:e.account},{name:"\u72B6\u6001\uFF1A",key:"status",type:d.Select,defaultValue:e.status,placeholder:"\u8BF7\u9009\u62E9\u8D26\u6237\u72B6\u6001",options:[{label:"\u542F\u7528",value:1},{label:"\u7981\u7528",value:2}]},{name:"\u89D2\u8272\uFF1A",key:"roles",type:d.MultiSelect,defaultValue:e.roles,placeholder:"\u8BF7\u9009\u62E9\u8D26\u6237\u89D2\u8272",options:[{label:"\u8D85\u7EA7\u7528\u6237",value:"su"},{label:"\u7BA1\u7406\u5458",value:"admin"}]}]}const p="list",y="update";var K=T({name:"UsersView",setup(){const e=F(),{users:r,info:o}=g(),n=m(p),u=m({}),a=m(!1),c=async t=>I({limit:t.limit,offset:t.offset,keyword:t.keyword||"",status:t.status||"",role:t.role||""}),i=async t=>{const l=j(t,u.value);if(l.modifiedCount===0){E(e,"\u8BF7\u5148\u66F4\u65B0\u4FE1\u606F");return}if(!a.value)try{a.value=!0,await U({id:u.value.id,data:l.data}),n.value=p}catch(f){x(e,f)}finally{a.value=!1}};return B(()=>{k()}),{mode:n,updatedUser:u,userInfo:o,users:r,updating:a,fetchUsers:c,update:i}},render(){const{users:e,fetchUsers:r,userInfo:o,mode:n,updatedUser:u,update:a,updating:c}=this;if(n===y){const l=L(u);return s(N,{show:c},{default:()=>[s(C,null,{default:()=>[s(w,{title:"\u7528\u6237\u4FE1\u606F\u66F4\u65B0",onBack:()=>{this.mode=p}},{default:()=>[s(b,{formItems:l,onSubmit:a,submitText:"\u66F4\u65B0"},null)]})]})]})}const i=D(),{roles:t}=o;if(t.includes("su")||t.includes("admin")){const l=f=>s(V,{bordered:!1,onClick:()=>{this.updatedUser=f,this.mode=y}},{default:()=>[s(S,{class:"mright5"},{default:()=>[s(v,null,null)]}),M("\u66F4\u65B0")]});i.push({title:"\u64CD\u4F5C",key:"op",render:l})}return s(h,{title:"\u7528\u6237\u67E5\u8BE2",columns:i,filters:G(),data:e,fetch:r},null)}});export{K as default};
