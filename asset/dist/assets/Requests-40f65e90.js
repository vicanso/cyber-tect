import{E as m}from"./ExLoading-572e76eb.js";import{s as h,w as f}from"./index-aeeb7070.js";import{h as y,i as g,j as k,k as S,l as v,E as q,u as x}from"./ExFluxDetail-8f36b2a4.js";import{E as R}from"./ExTable-dcbd254b.js";import{F as u}from"./ExFormInterface-d830d527.js";import{d as b,f as w,E,N as i,c as a}from"./ui-32540f7e.js";import{u as L,C as N}from"./naive-094f875f.js";import"./common-a7d1cc73.js";const n=[{label:"所有",value:""}],o=[{label:"所有",value:""}],T="u1nflspg";function C(){return[{key:"result",name:"结果：",type:u.Select,placeholder:"请选择要筛选的结果",options:[{label:"所有",value:""},{label:"成功",value:"0"},{label:"失败",value:"1"}]},{key:"service",name:"服务：",type:u.Select,placeholder:"请选择要筛选的调用服务",options:n},{key:"route",name:"路由",type:u.Select,placeholder:"请选择要筛选的调用路由",options:o},{key:"exception",name:"异常",type:u.Select,placeholder:"请选择是否筛选异常出错",options:[{label:"所有",value:""},{label:"是",value:"true"}]},{key:"limit",name:"查询数量：",type:u.InputNumber,placeholder:"请输入要查询的记录数量"},{key:"useGt",name:"请求耗时大于：",type:u.InputNumber,placeholder:"请输入要查询的耗时记录"},{key:"begin:end",name:"开始结束时间：",type:u.DateRange,span:8,defaultValue:[f(3).toISOString(),new Date().toISOString()]}]}function F(){return[{title:"服务名称",key:"service",width:100},{title:"请求路由",key:"route",width:200,ellipsis:{tooltip:!0}},{title:"完整地址",key:"uri",width:100,ellipsis:{tooltip:!0}},{title:"结果",key:"result",width:80,render(e){return e.result==="0"?"成功":"失败"}},{title:"状态码",key:"status",width:70},{title:"请求地址",key:"addr",width:150},{title:"耗时",key:"use",width:100,render(e){let s=0;if(e.use&&(s=e.use),!s)return"--";const r={trigger:()=>i("span",null,[s.toLocaleString(),a("ms")])},t=[],l=(p,c)=>{if(!e[p])return;const d=e[p];t.push(i("li",null,[c,a(": "),d.toLocaleString(),a("ms")]))};return l("dnsUse","DNS"),l("tcpUse","TCP"),l("tlsUse","TLS"),l("processingUse","PROCESSING"),l("transferUse","TRANSFER"),i(N,null,{default:()=>[i("ul",{class:T},[t])],...r})}},{title:"出错类型",key:"errCategory",width:100},{title:"异常",key:"exception",width:80,render(e){return e.exception?"是":"否"}},{title:"出错信息",key:"error"},{title:"完整记录",key:"requestDetail",width:90,render(e){return i(q,{measurement:v,data:e,tagKeys:["service","route","method","result"]},null)}},{title:"时间",key:"createdAt",width:180,fixed:"right"}]}const G=b({name:"RequestStats",setup(){const e=L(),{requestServices:s,requests:r,requestRoutes:t}=x();return w(async()=>{try{await y(),await g()}catch(l){h(e,l)}}),E(()=>{k()}),{requests:r,requestServices:s,requestRoutes:t}},render(){const{requests:e,requestServices:s,requestRoutes:r}=this;return s.processing||r.processing?i(m,null,null):(n.length===1&&s.items.length!==0&&s.items.forEach(t=>{n.push({label:t,value:t})}),o.length===1&&r.items.length!==0&&r.items.forEach(t=>{o.push({label:t,value:t})}),i(R,{disableAutoFetch:!0,hidePagination:!0,title:"HTTP请求统计",data:e,filters:C(),columns:F(),fetch:S},null))}});export{G as default};
