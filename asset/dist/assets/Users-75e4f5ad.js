import{E as h}from"./ExForm-cdb0faae.js";import{F as d}from"./ExFormInterface-d830d527.js";import{E as k,a as b}from"./ExTable-dcbd254b.js";import{j as v,k as g,l as U,m as I,a as N,o as w,s as C}from"./index-aeeb7070.js";import{u as E,r as S,A as F,s as V,e as x,d as B}from"./naive-094f875f.js";import{d as M,r as f,E as T,N as s,c as j}from"./ui-32540f7e.js";import"./detector-090ed643.js";import"./common-a7d1cc73.js";const D="ulmcati";function L(){return[{title:"账户",key:"account"},{title:"角色",key:"roles",render:e=>{if(!e.roles)return null;const o=e.roles.map(r=>s("li",null,[r]));return s("ul",{class:D},[o])}},{title:"状态",key:"statusDesc"},{title:"邮箱",key:"email"}]}function R(){return[{name:"角色：",key:"role",placeholder:"请选择要筛选的用户角色",type:d.Select,options:[{label:"所有",value:""},{label:"超级用户",value:"su"},{label:"管理员",value:"admin"}]},{name:"状态：",key:"status",placeholder:"请选择要筛选的账户状态",type:d.Select,options:[{label:"所有",value:""},{label:"启用",value:"1"},{label:"禁用",value:"2"}]},{name:"关键字：",key:"keyword",placeholder:"请输入搜索关键字"}]}function q(e){return[{name:"账号：",key:"account",disabled:!0,defaultValue:e.account},{name:"状态：",key:"status",type:d.Select,defaultValue:e.status,placeholder:"请选择账户状态",options:[{label:"启用",value:1},{label:"禁用",value:2}]},{name:"角色：",key:"roles",type:d.MultiSelect,defaultValue:e.roles,placeholder:"请选择账户角色",options:[{label:"超级用户",value:"su"},{label:"管理员",value:"admin"}]}]}const p="list",y="update",K=M({name:"UsersView",setup(){const e=E(),{users:o,info:r}=g(),n=f(p),u=f({}),a=f(!1),c=async t=>U({limit:t.limit,offset:t.offset,keyword:t.keyword||"",status:t.status||"",role:t.role||""}),i=async t=>{const l=I(t,u.value);if(l.modifiedCount===0){N(e,"请先更新信息");return}if(!a.value)try{a.value=!0,await w({id:u.value.id,data:l.data}),n.value=p}catch(m){C(e,m)}finally{a.value=!1}};return T(()=>{v()}),{mode:n,updatedUser:u,userInfo:r,users:o,updating:a,fetchUsers:c,update:i}},render(){const{users:e,fetchUsers:o,userInfo:r,mode:n,updatedUser:u,update:a,updating:c}=this;if(n===y){const l=q(u);return s(V,{show:c},{default:()=>[s(S,null,{default:()=>[s(F,{title:"用户信息更新",onBack:()=>{this.mode=p}},{default:()=>[s(h,{formItems:l,onSubmit:a,submitText:"更新"},null)]})]})]})}const i=L(),{roles:t}=r;if(t.includes("su")||t.includes("admin")){const l=m=>s(B,{bordered:!1,onClick:()=>{this.updatedUser=m,this.mode=y}},{default:()=>[s(x,{class:"mright5"},{default:()=>[s(b,null,null)]}),j("更新")]});i.push({title:"操作",key:"op",render:l})}return s(k,{title:"用户查询",columns:i,filters:R(),data:e,fetch:o},null)}});export{K as default};
