import{w as x}from"./detector-090ed643.js";import{F as N,G as b,u as z,y as V,H as U,I as h,J as k,K as I,L as F,x as g,w as S,d as v,v as D,t as T}from"./naive-094f875f.js";import{d as w,r as i,N as a,c as j,i as E}from"./ui-32540f7e.js";import{F as d}from"./ExFormInterface-d830d527.js";import{s as G,I as q}from"./index-aeeb7070.js";const O=w({name:"UserSelect",props:{formItem:{type:Object,required:!0},size:{type:String,required:!0},multiple:{type:Boolean,default:!0},onUpdateValue:{type:Function,required:!0}},setup(){const s=i([]),n=i(!1);return{options:s,loading:n,onSearch:async p=>{n.value=!0;try{const r=await x(p);s.value=r.map(o=>({label:o,value:o}))}finally{n.value=!1}}}},render(){const{formItem:s,size:n,multiple:t}=this.$props,{loading:p,options:r,onSearch:o,onUpdateValue:f}=this;return a(N,{multiple:t,defaultValue:s.defaultValue,size:n,filterable:!0,clearable:!0,options:r,placeholder:s.placeholder,loading:p,onUpdateValue:f,remote:!0,onSearch:o},null)}});function m(s){return typeof s=="function"||Object.prototype.toString.call(s)==="[object Object]"&&!E(s)}const P=w({name:"ExForm",props:{formItems:{type:Array,required:!0},onSubmit:{type:Function,required:!0},submitText:{type:String,default:"提交"},rules:{type:Object,default:null}},setup(s){const n=i({}),t=i({});s.formItems.forEach(o=>{o.defaultValue&&b(t.value,o.key,o.defaultValue)});const p=()=>new Promise((o,f)=>{n.value.validate(c=>{if(c){const e=c.map(u=>u.map(l=>l.message).join(","));f(new Error(e.join(";")));return}o()})}),r=z();return{handleSubmit:async o=>{try{await p()}catch(f){G(r,f);return}return s.onSubmit(o)},params:t,formRef:n}},render(){const{submitText:s,rules:n}=this.$props,{params:t,handleSubmit:p}=this,r="large",o=(e,u)=>a(N,{filterable:!0,multiple:u,defaultValue:e.defaultValue,size:r,options:e.options||[],placeholder:e.placeholder,onUpdateValue:l=>{b(t,e.key,l)}},null),c=this.$props.formItems.map(e=>{let u;switch(e.type){case d.Blank:u=a("div",null,null);break;case d.MultiSelect:u=o(e,!0);break;case d.Select:u=o(e,!1);break;case d.MultiUserSelect:u=a(O,{formItem:e,multiple:!0,size:r,onUpdateValue:l=>{t[e.key]=l}},null);break;case d.DateTime:{let l=null;e.defaultValue&&(l=new Date(e.defaultValue).getTime()),u=a(F,{type:"datetime",class:"widthFull",size:r,placeholder:e.placeholder,defaultValue:l,clearable:!0,onUpdateValue:y=>{y?t[e.key]=new Date(y).toISOString():t[e.key]=""}},null)}break;case d.InputNumber:u=a(h,{class:"widthFull",disabled:e.disabled||!1,size:r,placeholder:e.placeholder,defaultValue:e.defaultValue||null,"onUpdate:value":l=>{t[e.key]=l}},null);break;case d.InputNumberGroup:u=a(I,null,{default:()=>[a(h,{class:"widthFull",disabled:e.disabled||!1,size:r,placeholder:e.placeholder,defaultValue:e.defaultValue||null,"onUpdate:value":l=>{t[e.key]=l}},null),e.suffix&&a(k,{size:r},{default:()=>[e.suffix]})]});break;case d.InputDuration:u=a(I,null,{default:()=>[a(h,{class:"widthFull",disabled:e.disabled||!1,size:r,placeholder:e.placeholder,defaultValue:q(e.defaultValue)||null,"onUpdate:value":l=>{t[e.key]=`${l}s`}},null),a(k,{size:r},{default:()=>[j("秒")]})]});break;case d.TextArea:u=a(V,{type:"textarea",autosize:{minRows:3,maxRows:5},disabled:e.disabled||!1,size:r,placeholder:e.placeholder,defaultValue:e.defaultValue||"",onUpdateValue:l=>{t[e.key]=l},clearable:!0},null);break;case d.DynamicInput:u=a(U,{placeholder:e.placeholder,defaultValue:e.defaultValue||[],onUpdateValue:l=>{t[e.key]=l},min:e.min,max:e.max},null);break;default:u=a(V,{disabled:e.disabled||!1,size:r,placeholder:e.placeholder,defaultValue:e.defaultValue||"",onUpdateValue:l=>{b(t,e.key,l)},clearable:!0},null);break}return a(S,{span:e.span||8},{default:()=>[a(g,{label:e.name,path:e.key},m(u)?u:{default:()=>[u]})]})});return c.push(a(S,{span:24},{default:()=>[a(v,{size:r,class:"widthFull",onClick:()=>p(t)},m(s)?s:{default:()=>[s]})]})),a(T,{labelPlacement:"left",rules:n,model:t,ref:"formRef"},{default:()=>[a(D,{xGap:24},m(c)?c:{default:()=>[c]})]})}});export{P as E};
