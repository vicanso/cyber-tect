import{b as g}from"./configs-5a9029c7.js";import{E as N}from"./ExForm-cdb0faae.js";import{F as c}from"./ExFormInterface-d830d527.js";import{E as F}from"./ExLoading-572e76eb.js";import{s as w,m as O,a as j,B as V,M as p,k as L}from"./index-aeeb7070.js";import{d as v,r as y,N as s,c as R}from"./ui-32540f7e.js";import{u as M,r as B,A as T,s as U,d as X}from"./naive-094f875f.js";import{c as I,E as z,n as P}from"./ExTable-dcbd254b.js";function q(){}var n=function(e){return e.name="name",e.status="status",e.timeout="timeout",e.owners="owners",e.receivers="receivers",e.description="description",e.interval="interval",e}(n||{});function $(){return[{name:"名称：",key:n.name,span:6,placeholder:"请输入检测配置名称"},{name:"状态：",key:n.status,type:c.Select,placeholder:"请选择配置状态",span:4,options:[{label:"启用",value:g.Enabled},{label:"禁用",value:g.Disabled}],defaultValue:g.Enabled},{name:"超时时长：",span:7,key:n.timeout,type:c.InputDuration,placeholder:"请输入超时时长",defaultValue:"5s"},{name:"检测间隔：",span:7,key:n.interval,type:c.InputDuration,placeholder:"请输入检测间隔"},{name:"用户列表：",key:n.owners,type:c.MultiUserSelect,placeholder:"请选择可以修改此配置的用户",span:12},{name:"告警接收：",key:n.receivers,type:c.MultiUserSelect,placeholder:"请选择接收此告警的用户",span:12}]}function b(e){return{required:!0,message:e,trigger:"blur"}}function ie(e){return{required:!0,message:e,trigger:"blur",validator(r,t){return!(!t||!t.length)}}}function ne(e){const r={[n.name]:b("配置名称不能为空"),[n.status]:{required:!0,message:"配置状态不能为空",trigger:"blur",validator(t,i){return!!i}},[n.timeout]:b("超时配置不能为空"),[n.description]:b("配置说明不能为空")};return e?Object.assign(r,e):r}function H(e,r){e.forEach(t=>{if(!t.key)return;const i=r[t.key];t.defaultValue=i})}const W=v({name:"ExDetectorEditor",props:{id:{type:Number,default:0},title:{type:String,required:!0},description:{type:String,required:!0},descriptionDetail:{type:Object,default:()=>null},formItems:{type:Array,required:!0},onBack:{type:Function,default:q},findByID:{type:Function,required:!0},updateByID:{type:Function,required:!0},create:{type:Function,required:!0},rules:{type:Object,default:null}},setup(e){const r=M(),t=y(!1),i=y(!1),a=[];e.formItems.forEach(u=>{a.push(Object.assign({},u))}),a.push({name:"配置描述：",key:n.description,type:c.TextArea,placeholder:"请输入配置描述",span:24});let o;const d=async()=>{if(!t.value){t.value=!0;try{o=await e.findByID(e.id),H(a,o)}catch(u){w(r,u)}finally{t.value=!1}}},f=async u=>{if(!i.value)try{if(i.value=!0,!e.id){await e.create(u),e.onBack();return}const l=O(u,o);if(!l.modifiedCount){j(r,"数据未修改无需要更新");return}await e.updateByID(e.id,l.data),e.onBack()}catch(l){w(r,l)}finally{i.value=!1}};return e.id&&d(),{fetching:t,processing:i,items:a,submit:f}},render(){const{title:e,description:r,id:t,onBack:i,descriptionDetail:a,rules:o}=this.$props,{fetching:d,processing:f,items:u,submit:l}=this;return d&&t?s(F,null,null):s(U,{show:d||f},{default:()=>[s(B,null,{default:()=>[s(T,{title:e,onBack:i==q?void 0:i,subtitle:r},{default:()=>[a,s(N,{formItems:u,onSubmit:l,submitText:t!==0?"更新":"添加",rules:o},null)]})]})]})}});function _(){return[{title:"名称",key:"name",width:120,fixed:"left"},{title:"状态",key:"status",render(e){return e.statusDesc},width:60},{title:"超时设置",key:"timeout",width:80},{title:"检测间隔",key:"interval",width:80},I({key:"owners",title:"所有人",width:120}),I({key:"receivers",title:"告警接收人",width:120}),{title:"更新于",key:"updatedAt",width:180,render(e){return V(e.updatedAt)}},{title:"配置描述",key:"description",width:100,ellipsis:{tooltip:!0}}]}const G="a1r7hurf",ue=v({name:"DetectorView",props:{title:{type:String,required:!0},description:{type:String,required:!0},descriptionDetail:{type:Object,default:()=>null},columns:{type:Array,required:!0},formItems:{type:Array,required:!0},fetch:{type:Function,required:!0},findByID:{type:Function,required:!0},updateByID:{type:Function,required:!0},create:{type:Function,required:!0},data:{type:Object,required:!0},rules:{type:Object,default:null},tableScrollX:{type:Number,default:()=>null}},setup(){const e=y(p.List),r=y(0);return{mode:e,updatedID:r,userInfo:L().info}},render(){const{data:e,findByID:r,updateByID:t,create:i,title:a,description:o,formItems:d,columns:f,fetch:u,descriptionDetail:l,rules:E,tableScrollX:S}=this.$props,{userInfo:C}=this,h=_().slice(0);h.splice(1,0,...f);const k=P(m=>{this.mode=p.Update,this.updatedID=m.id});k.fixed="right",h.push(k);const{mode:x,updatedID:A}=this;if(x===p.List)return s(B,{title:a},{default:()=>[s(z,{columns:h,data:e,fetch:u,scrollX:S,pageSize:10},null),s(X,{size:"large",onClick:()=>{this.updatedID=0,this.mode=p.Add},class:G},{default:()=>[R("增加检测配置")]})]});const D=$();return D.forEach(m=>{["owners","receivers"].includes(m.key)&&(m.defaultValue=[C.account])}),D.push(...d),s(W,{id:A,findByID:r,updateByID:t,create:i,title:a,description:o,formItems:D,descriptionDetail:l,onBack:()=>{this.mode=p.List},rules:E},null)}});export{ue as D,ie as a,ne as g,b as n};
