import{a as b,s as D}from"./index-aeeb7070.js";import{b as h,d as S,e as v,f as V}from"./configs-5a9029c7.js";import{E as x}from"./ExForm-cdb0faae.js";import{F as f}from"./ExFormInterface-d830d527.js";import{E as N}from"./ExLoading-572e76eb.js";import{d as F,r as A,N as l}from"./ui-32540f7e.js";import{u as I,r as O,A as T,s as B}from"./naive-094f875f.js";function L(e){return[{name:"名称：",key:"name",disabled:e.name!=null,defaultValue:e.name,placeholder:"请输入配置名称"},{name:"分类：",key:"category",disabled:!0,defaultValue:e.category},{name:"状态：",key:"status",type:f.Select,placeholder:"请选择配置状态",options:[{label:"启用",value:h.Enabled},{label:"禁用",value:h.Disabled}]},{name:"开始时间：",key:"startedAt",type:f.DateTime,placeholder:"请选择配置生效开始时间"},{name:"结束时间：",key:"endedAt",type:f.DateTime,placeholder:"请选择配置生效结束时间"}]}function j(e){const a="data.",t={};Object.keys(e).forEach(d=>{d.startsWith(a)&&(t[d.substring(a.length)]=e[d])});let n=e.data;return Object.keys(t).length!==0&&(n=JSON.stringify(t)),{name:e.name,status:e.status,category:e.category,startedAt:e.startedAt,endedAt:e.endedAt,data:n,description:e.description}}function q(e,a){const t={};return e.name!=a.name&&(t.name=e.name),e.status!=a.status&&(t.status=e.status),e.category!==a.category&&(t.category=e.category),e.startedAt!==a.startedAt&&(t.startedAt=e.startedAt),e.endedAt!==a.endedAt&&(t.endedAt=e.endedAt),e.data!==a.data&&(t.data=e.data),e.description!==a.description&&(t.description=e.description),t}function p(){}const $=F({name:"ExConfigEditor",props:{id:{type:Number,default:0},title:{type:String,required:!0},description:{type:String,required:!0},formItems:{type:Array,required:!0},onSubmitDone:{type:Function,default:p},onBack:{type:Function,default:p}},setup(e){const a=I(),t=e.id!==0,n=A(!1),d=A({}),c=async s=>{if(n.value)return;const{name:r,category:i,status:m,startedAt:k,endedAt:E}=s;if(!r||!i||!m||!k||!E){b(a,"配置名称、分类、状态、开始时间、结束时间均不能为空");return}try{n.value=!0;const u=j(s);if(t){const g=q(u,d.value);if(Object.keys(g).length===0){b(a,"数据未修改无需要更新");return}await S({id:e.id,data:g}),d.value=u}else await v(u);e.onSubmitDone()}catch(u){D(a,u)}finally{n.value=!1}},o=[];return e.formItems.forEach(s=>{o.push(Object.assign({},s))}),o.push({name:"配置描述：",key:"description",type:f.TextArea,placeholder:"请输入配置描述",span:24}),t&&(async()=>{n.value=!0;try{const s=await V(e.id);d.value=s,o.forEach(r=>{if(r.key)switch(r.key){case"name":r.defaultValue=s.name;break;case"category":r.defaultValue=s.category;break;case"status":r.defaultValue=s.status;break;case"startedAt":r.defaultValue=s.startedAt;break;case"endedAt":r.defaultValue=s.endedAt;break;case"data":r.defaultValue=s.data;break;case"description":r.defaultValue=s.description;break;default:{const i=r.key.split(".");if(i.length===2&&i[0]==="data")try{r.defaultValue=JSON.parse(s.data)[i[1]]}catch(m){console.error(m)}}break}})}finally{n.value=!1}})(),{currentConfig:d,processing:n,onSubmit:c,items:o}},render(){const{title:e,description:a,id:t,onBack:n}=this.$props,{onSubmit:d,processing:c,items:o,currentConfig:y}=this;return c&&t&&!y.id?l(N,null,null):l(B,{show:c},{default:()=>[l(O,null,{default:()=>[l(T,{title:e,onBack:n==p?void 0:n,subtitle:a},{default:()=>[l(x,{formItems:o,onSubmit:d,submitText:t!==0?"更新":"添加"},null)]})]})]})}});export{$ as E,L as g};
