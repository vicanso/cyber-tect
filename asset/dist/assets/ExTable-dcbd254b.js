import{q as P,a5 as R,a6 as B,s as q,I as H}from"./index-aeeb7070.js";import{F as m}from"./ExFormInterface-d830d527.js";import{u as K,y as X,I as M,F as _,s as $,t as Q,v as W,M as Y,O as Z,r as ee,L as te,J as ae,K as le,x as ne,w as U,d as j,e as re}from"./naive-094f875f.js";import{d as G,I as se,J as ue,K as oe,r as S,f as ie,N as a,i as ce,c as z}from"./ui-32540f7e.js";const de={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 576 512"},fe=oe("path",{d:"M402.3 344.9l32-32c5-5 13.7-1.5 13.7 5.7V464c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h273.5c7.1 0 10.7 8.6 5.7 13.7l-32 32c-1.5 1.5-3.5 2.3-5.7 2.3H48v352h352V350.5c0-2.1.8-4.1 2.3-5.6zm156.6-201.8L296.3 405.7l-90.4 10c-26.2 2.9-48.5-19.2-45.6-45.6l10-90.4L432.9 17.1c22.9-22.9 59.9-22.9 82.7 0l43.2 43.2c22.9 22.9 22.9 60 .1 82.8zM460.1 174L402 115.9L216.2 301.8l-7.3 65.3l65.3-7.3L460.1 174zm64.8-79.7l-43.2-43.2c-4.1-4.1-10.8-4.1-14.8 0L436 82l58.1 58.1l30.9-30.9c4-4.2 4-10.8-.1-14.9z",fill:"currentColor"},null,-1),pe=[fe],he=G({name:"EditRegular",render:function(n,l){return se(),ue("svg",de,pe)}});function v(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!ce(e)}const me="pyx5alf",ye="u13tuy86";function Ve(e){return{title:e.title,key:e.key,width:e.width,render:n=>{const l=n[e.key];if(!l||l.length===0)return"--";const u=l.map(s=>a("li",null,[s]));return a("ul",{class:ye},[u])}}}function De(e){return{title:e.title,width:e.width,key:e.key,render:n=>{const l=e.key.split("."),u=l.pop()||"";let s=n;return l.forEach(p=>s=s[p]),a("span",null,[s[u]])}}}function xe(e){return{title:"操作",key:"op",width:80,render(n){return a(j,{bordered:!1,onClick:()=>{e(n)}},{default:()=>[a(re,null,{default:()=>[a(he,null,null)]}),z("更新")]})}}}function ge(e){if(e.length<2)return!1;const n=e[0],l=e[e.length-1];return!(n!=="{"&&n!=="["||l!=="}"&&l!=="]")}function Se(e){return{type:"expand",expandable:()=>!0,renderExpand:n=>{const l=n[e];return ge(l.trim())?a("pre",null,[JSON.stringify(JSON.parse(l),null,2)]):l}}}const ve=G({name:"ExTable",props:{title:{type:String,default:""},columns:{type:Array,required:!0},data:{type:Object,required:!0},fetch:{type:Function,required:!0},limit:{type:Number,default:15},filters:{type:Array,default:()=>[]},hidePagination:{type:Boolean,default:()=>!1},disableAutoFetch:{type:Boolean,default:()=>!1},scrollX:{type:Number,default:()=>null},pageSize:{type:Number,default:()=>0}},setup(e){var w;const n=K(),l=S(0),u=S(!1),s=S({});(w=e.filters)==null||w.forEach(f=>{const c=f;if(c.defaultValue)switch(c.type){case m.DateRange:{const b=c.key.split(":"),D=c.defaultValue;b.forEach((x,N)=>{s.value[x]=D[N]});break}default:s.value[c.key]=c.defaultValue}});const p=async()=>{if(!u.value)try{u.value=!0,await e.fetch(Object.assign({limit:e.limit,offset:l.value},s.value))}catch(f){q(n,f)}finally{u.value=!1}};return e.disableAutoFetch||ie(()=>{p()}),{processing:u,fetchData:p,filterParams:s,offset:l}},render(){const{offset:e,fetchData:n,filterParams:l,$slots:u,processing:s}=this,{columns:p,data:w,limit:f,filters:c,title:b,hidePagination:D,scrollX:x,pageSize:N}=this.$props,E=w,I=Math.ceil(E.count/f),J=Math.floor(e/f)+1,A={最近1小时:[Date.now()-3600*1e3,Date.now()],最近3小时:[Date.now()-3*3600*1e3,Date.now()],最近6小时:[Date.now()-3*3600*1e3,Date.now()],今天:[P().getTime(),Date.now()],昨天:[R().getTime(),P().getTime()-1],最近3天:[B(2).getTime(),Date.now()],最近7天:[B(6).getTime(),Date.now()]},d="large";let F=0;const h=c.map(y=>{const t=y,T=t.span||6;F+=T;let o;switch(t.type){case m.Select:o=a(_,{filterable:!0,defaultValue:t.defaultValue,size:d,options:t.options||[],placeholder:t.placeholder,onUpdateValue:r=>{l[t.key]=r}},null);break;case m.MultiSelect:o=a(_,{filterable:!0,defaultValue:t.defaultValue,size:d,multiple:!0,options:t.options||[],placeholder:t.placeholder,onUpdateValue:r=>{let g="";r&&(g=r.join(",")),l[t.key]=g}},null);break;case m.InputNumber:o=a(M,{class:"widthFull",size:d,placeholder:t.placeholder,defaultValue:t.defaultValue,"onUpdate:value":r=>{l[t.key]=r}},null);break;case m.InputDuration:o=a(le,null,{default:()=>[a(M,{class:"widthFull",size:d,placeholder:t.placeholder,defaultValue:H(t.defaultValue)||null,"onUpdate:value":r=>{l[t.key]=`${r||0}s`}},null),a(ae,{size:d},{default:()=>[z("秒")]})]});break;case m.DateRange:{let r=null;if(t.defaultValue){const i=t.defaultValue;r=[Date.now(),Date.now()],i.forEach((L,V)=>{r&&(r[V]=new Date(L).getTime())})}let g=t.placeholder,C=t.placeholder;if(t.placeholder){const i=t.placeholder.split(":");i.length===2&&(g=i[0],C=i[1])}o=a(te,{class:"widthFull",format:"yyyy-MM-dd HH:mm:ss",size:d,defaultValue:r,"start-placeholder":g,"end-placeholder":C,ranges:A,type:"daterange",clearable:!0,onUpdateValue:i=>{t.key.split(":").forEach((V,O)=>{if(!i||i.length<=O){l[V]="";return}l[V]=new Date(i[O]).toISOString()})}},null);break}default:o=a(X,{clearable:!0,size:d,placeholder:t.placeholder,defaultValue:t.defaultValue,onUpdateValue:r=>{l[t.key]=r.trim()}},null);break}return a(U,{span:T},{default:()=>[a(ne,{label:t.name},v(o)?o:{default:()=>[o]})]})});if(h.length!==0){const y=24-F%24;h.push(a(U,{span:y},{default:()=>[a(j,{class:"widthFull",size:d,onClick:()=>{this.offset=0,n()}},{default:()=>[z("筛选")]})]}))}const k=a("div",{class:"clearfix"},[a($,{show:s},{default:()=>[h.length!==0&&a(Q,{labelPlacement:"left"},{default:()=>[a(W,{xGap:24},v(h)?h:{default:()=>[h]})]}),a(Y,{columns:p,data:E.items,scrollX:x,pagination:N===0?void 0:{pageSize:N}},null),!D&&I>1&&a(Z,{page:J,pageCount:I,class:me,onUpdatePage:y=>{this.offset=(y-1)*f,n()}},null),u.default&&u.default()]})]);return b?a(ee,{title:b},v(k)?k:{default:()=>[k]}):k}});export{ve as E,he as a,Se as b,Ve as c,De as d,xe as n};
